{"version":3,"file":"index.js","sources":["../../src/components/menu.tsx","../../src/components/menuItem.tsx"],"sourcesContent":["import React from \"react\";\r\nimport { MenuItemProps } from \"./menuItem\";\r\n\r\nconst defaultOptions: IntersectionObserverInit = {\r\n  rootMargin: \"-25% 0px -55% 0px\",\r\n};\r\n\r\nexport interface MenuProps {\r\n  children: React.ReactNode;\r\n  root?: Element | Document;\r\n  options?: IntersectionObserverInit;\r\n  as?: keyof JSX.IntrinsicElements;\r\n  className?: string;\r\n  onItemActive?: (sectionId: string) => void;\r\n  paddingTop?: number;\r\n}\r\n\r\nexport const Menu = ({\r\n  children,\r\n  root = document,\r\n  options = {},\r\n  onItemActive,\r\n  as = \"menu\",\r\n  className,\r\n  paddingTop = 64,\r\n}: MenuProps) => {\r\n  const observerOptions: IntersectionObserverInit = {\r\n    root,\r\n    ...defaultOptions,\r\n    ...options,\r\n  };\r\n\r\n  const [visibleSections, setVisibleSections] = React.useState<Set<string>>(\r\n    new Set()\r\n  );\r\n  const [allSections, setAllSections] = React.useState<string[]>([]);\r\n\r\n  React.useEffect(() => {\r\n    if (visibleSections.size === 0) return;\r\n    const visibleSectionsOrdered = allSections.filter((section) =>\r\n      visibleSections.has(section)\r\n    );\r\n    onItemActive?.(visibleSectionsOrdered[0]);\r\n  }, [visibleSections, allSections]);\r\n\r\n  const updateVisibleSections: IntersectionObserverCallback = React.useCallback(\r\n    (entries) => {\r\n      setVisibleSections((oldSections) => {\r\n        // Clone because state is immutable\r\n        const newSections = new Set(oldSections);\r\n        entries.forEach((e) => {\r\n          if (e.isIntersecting) {\r\n            newSections.add(e.target.id);\r\n          } else {\r\n            newSections.delete(e.target.id);\r\n          }\r\n        });\r\n        return newSections;\r\n      });\r\n    },\r\n    []\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    const observer = new IntersectionObserver(\r\n      updateVisibleSections,\r\n      observerOptions\r\n    );\r\n    const sectionIds: string[] = [];\r\n\r\n    React.Children.forEach(children, (child) => {\r\n      if (!React.isValidElement<MenuItemProps>(child)) return;\r\n\r\n      const { sectionId } = child.props;\r\n      sectionIds.push(sectionId);\r\n      const section = getSectionWithError(sectionId);\r\n      if (!section) {\r\n        return;\r\n      }\r\n      observer.observe(section);\r\n    });\r\n    setAllSections(sectionIds);\r\n\r\n    return () => {};\r\n  }, [updateVisibleSections]);\r\n\r\n  const onItemClick = React.useCallback((sectionId: string) => {\r\n    onItemActive?.(sectionId);\r\n    const section = getSectionWithError(sectionId);\r\n    if (!section) {\r\n      return;\r\n    }\r\n    const top = section.offsetTop - paddingTop;\r\n    window.scrollTo({ top, behavior: \"smooth\" });\r\n  }, []);\r\n\r\n  const childrenWithClickListener = React.Children.map(children, (child) => {\r\n    if (React.isValidElement<MenuItemProps>(child)) {\r\n      return React.cloneElement(child, {\r\n        onItemClick: () => onItemClick(child.props.sectionId),\r\n      });\r\n    }\r\n    return child;\r\n  });\r\n  return React.createElement(as, { className }, childrenWithClickListener);\r\n};\r\n\r\nfunction getSectionWithError(sectionId: string): HTMLElement | null {\r\n  const section = document.getElementById(sectionId);\r\n  if (!section) {\r\n    console.error(`No section found with id ${sectionId}`);\r\n  }\r\n  return section;\r\n}\r\n","import React from \"react\";\r\n\r\nexport interface MenuItemProps {\r\n  sectionId: string;\r\n  children: React.ReactNode;\r\n  onItemClick?: () => void;\r\n  as?: keyof JSX.IntrinsicElements;\r\n  className?: string;\r\n}\r\n\r\nexport const MenuItem: React.FC<MenuItemProps> = ({\r\n  children,\r\n  onItemClick,\r\n  as = \"li\",\r\n  className,\r\n}) => {\r\n  return React.createElement(as, { className, onClick: onItemClick }, children);\r\n};\r\n"],"names":[],"mappings":"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"}