{"version":3,"file":"index.js","sources":["../../src/components/menu.tsx","../../src/components/menuItem.tsx"],"sourcesContent":["import {\n  Children,\n  cloneElement,\n  isValidElement,\n  useEffect,\n  useState,\n  useCallback,\n  ReactNode\n} from \"react\";\nimport { MenuItemProps } from \"./menuItem\";\n\nconst defaultOptions: IntersectionObserverInit = {\n  rootMargin: \"-25% 0px -55% 0px\",\n};\n\nexport interface MenuProps {\n  children: ReactNode;\n  root?: Element | Document;\n  options?: IntersectionObserverInit;\n  as?: keyof JSX.IntrinsicElements;\n  className?: string;\n  onItemActive?: (sectionId: string) => void;\n  paddingTop?: number;\n}\n\nexport const Menu = ({\n  children,\n  root,\n  options = {},\n  onItemActive,\n  className,\n}: MenuProps) => {\n  const [visibleSections, setVisibleSections] = useState<Set<string>>(\n    new Set()\n  );\n  const [allSections, setAllSections] = useState<string[]>([]);\n\n  useEffect(() => {\n    if (visibleSections.size === 0) return;\n    const visibleSectionsOrdered = allSections.filter((section) =>\n      visibleSections.has(section)\n    );\n    onItemActive?.(visibleSectionsOrdered[0]);\n  }, [visibleSections, allSections]);\n\n  const updateVisibleSections: IntersectionObserverCallback = useCallback(\n    (entries: IntersectionObserverEntry[]) => {\n      setVisibleSections((oldSections) => {\n        // Clone because state is immutable\n        const newSections = new Set(oldSections);\n        entries.forEach((e) => {\n          if (e.isIntersecting) {\n            newSections.add(e.target.id);\n          } else {\n            newSections.delete(e.target.id);\n          }\n        });\n        return newSections;\n      });\n    },\n    []\n  );\n\n  // Get all section ids from children and setup intersection observer\n  useEffect(() => {\n    const observerOptions: IntersectionObserverInit = {\n      root: root || document,\n      ...defaultOptions,\n      ...options,\n    };\n    const observer = new IntersectionObserver(\n      updateVisibleSections,\n      observerOptions\n    );\n    const sectionIds: string[] = [];\n\n    Children.forEach(children, (child) => {\n      if (!isValidElement<MenuItemProps>(child)) return;\n\n      const { sectionId } = child.props;\n      sectionIds.push(sectionId);\n      const section = getSectionWithError(sectionId);\n      if (!section) {\n        return;\n      }\n      observer.observe(section);\n    });\n    setAllSections(sectionIds);\n\n    return () => {};\n  }, []);\n\n  const childrenWithClickListener = Children.map(children, (child) => {\n    if (isValidElement<MenuItemProps>(child)) {\n      return cloneElement(child, {\n        onItemClick: () => onItemActive?.(child.props.sectionId),\n      });\n    }\n    return child;\n  });\n  return (\n    <nav className={className}>\n      <ul>{childrenWithClickListener}</ul>\n    </nav>\n  );\n};\n\nfunction getSectionWithError(sectionId: string): HTMLElement | null {\n  const section = document.getElementById(sectionId);\n  if (!section) {\n    console.error(`No section found with id ${sectionId}`);\n  }\n  return section;\n}\n","import { FC, ReactNode } from \"react\";\n\nexport interface MenuItemProps {\n  sectionId: string;\n  children: ReactNode;\n  onItemClick?: () => void;\n  className?: string;\n}\n\nexport const MenuItem: FC<MenuItemProps> = ({\n  children,\n  className = \"\",\n  sectionId,\n  onItemClick,\n}) => {\n  return (\n    <li className={className} onClick={() => onItemClick?.()}>\n      <a href={`#${sectionId}`}>{children}</a>\n    </li>\n  );\n};\n"],"names":["useState","useEffect","useCallback","Children","isValidElement","cloneElement","_jsx"],"mappings":"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"}